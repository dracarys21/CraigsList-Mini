@model Data.Models.PostFilterViewModel

@{
    ViewBag.Title = "Index";
}

<h2>Search Results</h2>

<div class="row">
    <div class="col">
        <div class="form-group">
            @Html.LabelFor(model => model.Areas, htmlAttributes: new { @class = "control-label" })
            <div class="col-md-10">
                @Html.DropDownListFor(model => model.Area,
                    Model.Areas,
                    new
                    {
                        @class = "form-control",
                        @id = "ddlareas",
                        @onchange = "javascript:GetLocales(this.value);"
                    })
            </div>
        </div>
    </div>
    <div class="col">
        @Html.LabelFor(model => model.Locales, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            <select id="SelectedLocale" name="SelectedLocale" class="form-control"></select>
        </div>
    </div>
    <div class="col">
        @Html.LabelFor(model => model.Categories, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.DropDownListFor(model => model.Category,
                Model.Categories,
                new { @class = "form-control",
                    @id = "ddlcategories",
                    @onchange = "javascript:GetSubCategories(this.value);"
                })
        </div>
    </div>
    <div class="col">
        @Html.LabelFor(model => model.SubCategories, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            <select id="SelectedSubcategory" name="SelectedSubcategory" class="form-control"></select>
        </div>
    </div>
</div>

<nav class="navbar navbar-light bg-light">
    <form class="form-inline">
        <input id="query" name="query" class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
</nav>

<table class="table">
    @foreach (var item in Model.Posts)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.CreateDate)
            </td>
            <td>
                <span>
                    @Html.ActionLink(item.Title, "Details", "Posts")

                    (@Html.DisplayFor(modelItem => item.Locale))
                </span>

            </td>
        </tr>
    }
</table>

<nav aria-label="Page navigation example">
    <ul class="pagination">
        @{
            var prevListStyle = ViewBag.CurrentPage > 1 ? "page-item" : "page-item disabled";
            var nextListStyle = ViewBag.CurrentPage == ViewBag.PageCount ? "page-item disabled" : "page-item";

            var pgNo = ViewBag.CurrentPage;
            var nextPg = pgNo + 1;
            var prevPg = pgNo - 1;
            
            if (nextPg > ViewBag.PageCount)
            {
                nextPg = ViewBag.PageCount;
            }

            if (prevPg < 1)
            {
                prevPg = 1;
            }
             
        }

        <li class="@prevListStyle">
            @Html.ActionLink("Previous",
                "Index",
                new { pNo = prevPg.ToString() },
                new { @class = "page-link" })
        </li>

        @for (int i = 1; i < ViewBag.PageCount + 1; i++)
        {
            var listStyle = ViewBag.CurrentPage == i ? "page-item active" : "page-item";

            <li class="@listStyle">
                @Html.ActionLink(i.ToString(),
                    "Index",
                    new { pNo = i.ToString() },
                    new {@class = "page-link"})
            </li>
        }

        <li class="@nextListStyle">
            @Html.ActionLink("Next",
                "Index",
                new { pNo = nextPg.ToString()},
                new {@class = "page-link"})
        </li>
    </ul>
</nav>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script language="javascript" type="text/javascript">
        function GetSubCategories(_category) {
            var procemessage = "<option value='0'> Please wait...</option>";
            var url = "@Url.Action("GetSubCategoriesByCategory", "Posts")";

            $("#SelectedSubcategory").html(procemessage).show();
            $.ajax({
                url: url,
                data: { category: _category },
                cache: false,
                type: "POST",
                success: function (data) {
                    var markup = "<option value='0'>Select Subcategory</option>";
                    for (var x = 0; x < data.length; x++) {
                        markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                    }
                    $("#SelectedSubcategory").html(markup).show();
                },
                error: function (response) {
                    alert("error : " + response);
                }
            });
        }

        function GetLocales(_area) {
            var procemessage = "<option value='0'> Please wait...</option>";
            var url = "@Url.Action("GetLocalesByArea", "Posts")";

            $("#SelectedLocale").html(procemessage).show();
            $.ajax({
                url: url,
                data: { area: _area },
                cache: false,
                type: "POST",
                success: function (data) {
                    var markup = "<option value='0'>Select Locale</option>";
                    for (var x = 0; x < data.length; x++) {
                        markup += "<option value=" + data[x].Value + ">" + data[x].Text + "</option>";
                    }
                    $("#SelectedLocale").html(markup).show();
                },
                error: function (response) {
                    alert("error : " + response);
                }
            });
        }
    </script>
}
